
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.13">
    
    
      
        <title>AWS Lambda User Registration</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aws-lambda-user-registration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="AWS Lambda User Registration" class="md-header__button md-logo" aria-label="AWS Lambda User Registration" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWS Lambda User Registration
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="AWS Lambda User Registration" class="md-nav__button md-logo" aria-label="AWS Lambda User Registration" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AWS Lambda User Registration
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Home
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#topologia-de-rede" class="md-nav__link">
    Topologia de Rede
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tecnologias" class="md-nav__link">
    Tecnologias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicos-utilizados" class="md-nav__link">
    Serviços Utilizados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requisitos" class="md-nav__link">
    Requisitos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primeiros-passos" class="md-nav__link">
    Primeiros Passos
  </a>
  
    <nav class="md-nav" aria-label="Primeiros Passos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao-terraform" class="md-nav__link">
    Instalação Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracao-aws" class="md-nav__link">
    Configuração AWS
  </a>
  
    <nav class="md-nav" aria-label="Configuração AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criacao-de-usuario-e-acesso-as-credenciais" class="md-nav__link">
    Criação de usuário e acesso as credenciais
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracao-da-sua-conta-aws-no-powershell" class="md-nav__link">
    Configuração da sua conta AWS no powershell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-opcao" class="md-nav__link">
    1 opção
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-opcao" class="md-nav__link">
    2 opção
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilizacao-terraform" class="md-nav__link">
    Utilização terraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teste-infraestrutura-aws" class="md-nav__link">
    Teste Infraestrutura AWS
  </a>
  
    <nav class="md-nav" aria-label="Teste Infraestrutura AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recursos-criados" class="md-nav__link">
    Recursos Criados
  </a>
  
    <nav class="md-nav" aria-label="Recursos Criados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criacao-sqs" class="md-nav__link">
    Criação SQS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-lambda-function" class="md-nav__link">
    Criação lambda Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-rds" class="md-nav__link">
    Criação RDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-dynamodb" class="md-nav__link">
    Criação DynamoDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teste-dos-recursos" class="md-nav__link">
    Teste dos Recursos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#termino-e-destruicao-da-infraestrutura" class="md-nav__link">
    Término e destruição da Infraestrutura
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusao" class="md-nav__link">
    Conclusão
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#topologia-de-rede" class="md-nav__link">
    Topologia de Rede
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tecnologias" class="md-nav__link">
    Tecnologias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicos-utilizados" class="md-nav__link">
    Serviços Utilizados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requisitos" class="md-nav__link">
    Requisitos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primeiros-passos" class="md-nav__link">
    Primeiros Passos
  </a>
  
    <nav class="md-nav" aria-label="Primeiros Passos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao-terraform" class="md-nav__link">
    Instalação Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracao-aws" class="md-nav__link">
    Configuração AWS
  </a>
  
    <nav class="md-nav" aria-label="Configuração AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criacao-de-usuario-e-acesso-as-credenciais" class="md-nav__link">
    Criação de usuário e acesso as credenciais
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracao-da-sua-conta-aws-no-powershell" class="md-nav__link">
    Configuração da sua conta AWS no powershell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-opcao" class="md-nav__link">
    1 opção
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-opcao" class="md-nav__link">
    2 opção
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilizacao-terraform" class="md-nav__link">
    Utilização terraform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teste-infraestrutura-aws" class="md-nav__link">
    Teste Infraestrutura AWS
  </a>
  
    <nav class="md-nav" aria-label="Teste Infraestrutura AWS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recursos-criados" class="md-nav__link">
    Recursos Criados
  </a>
  
    <nav class="md-nav" aria-label="Recursos Criados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criacao-sqs" class="md-nav__link">
    Criação SQS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-lambda-function" class="md-nav__link">
    Criação lambda Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-rds" class="md-nav__link">
    Criação RDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criacao-dynamodb" class="md-nav__link">
    Criação DynamoDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teste-dos-recursos" class="md-nav__link">
    Teste dos Recursos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#termino-e-destruicao-da-infraestrutura" class="md-nav__link">
    Término e destruição da Infraestrutura
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusao" class="md-nav__link">
    Conclusão
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="aws-lambda-user-registration">AWS Lambda User Registration<a class="headerlink" href="#aws-lambda-user-registration" title="Permanent link">&para;</a></h1>
<p>Este projeto é um exemplo de um sistema de gerenciamento da função lambda que utiliza a AWS Lambda como serviço principal e SQS, Amazon Rds, DynamoDb e CloudWatch como serviços auxiliares.Assim, de forma prática pode-se fazer um sistema de gerenciamento de bancos de dados ou tabelas onde o SQS que é um sistema de filas(Queue) iria mandar uma mensagem em forma de json para cadastrar algum usuário para a função lambda por meio de um event source mapping e ,posteriormente, usa os dados dos eventos (cadastro do usuário) para atualizar tabelas do DynamoDB . Além disso, ele armazena uma cópia do evento em um banco de dados MySQL (Amazon Rds).</p>
<h2 id="topologia-de-rede">Topologia de Rede<a class="headerlink" href="#topologia-de-rede" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/eabea0ed-d34b-4e46-b903-faa5bb933036" /></p>
<h2 id="tecnologias">Tecnologias<a class="headerlink" href="#tecnologias" title="Permanent link">&para;</a></h2>
<p><a href="terraform logo" target="_blank"><img src="https://img.shields.io/badge/-TERRAFORM-blueviolet" target="_blank"></a>
<a href="python log" target="_blank"><img src="https://img.shields.io/badge/-PYTHON-blue" target="_blank"></a></p>
<h2 id="servicos-utilizados">Serviços Utilizados<a class="headerlink" href="#servicos-utilizados" title="Permanent link">&para;</a></h2>
<p>A aplicação de exemplo usa os seguintes serviços da AWS:</p>
<ul>
<li>
<p>SQS: O Amazon SQS envia mensagens(cadastro de usuários) para a função lambda que irá processá-las e envia-las para o banco de dados e a tabela do dynamoDB.</p>
</li>
<li>
<p>AWS Lambda: lê a mensagem do SQS e envia eventos para o código do handler da função.</p>
</li>
<li>
<p>DynamoDB: armazena listas geradas pela aplicação.</p>
</li>
<li>
<p>Amazon RDS: armazena uma cópia dos registros processados em um banco de dados relacional.</p>
</li>
<li>
<p>CloudWatch: Por meio dos streams de Log é possível saber se os cadastros foram criados.</p>
</li>
<li>
<p>Amazon VPC: fornece uma rede local privada para comunicação entre a função lambda e o banco de dados que necessitam estar na mesma subnet.</p>
</li>
</ul>
<h2 id="requisitos">Requisitos<a class="headerlink" href="#requisitos" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://aws.amazon.com/pt/">AWS account</a></li>
<li><a href="https://docs.aws.amazon.com/pt_br/IAM/latest/UserGuide/id_users_create.html">AWS IAM user (usuário criado)</a></li>
<li><a href="https://www.python.org/downloads/">Python</a></li>
<li><a href="https://developer.hashicorp.com/terraform/downloads">Terraform</a></li>
<li><a href="https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles">Acesso a console da AWS</a></li>
<li>Powershell</li>
</ul>
<h2 id="primeiros-passos">Primeiros Passos<a class="headerlink" href="#primeiros-passos" title="Permanent link">&para;</a></h2>
<h3 id="instalacao-terraform">Instalação Terraform<a class="headerlink" href="#instalacao-terraform" title="Permanent link">&para;</a></h3>
<p>Para a intalação do terraform siga o tutorial abaixo:
  -   <a href="https://www.youtube.com/watch?v=bSrV1Dr8py8&t=223s">Instalando o Terraform no Windows, Linux e MacOS</a></p>
<p>Para conferir se o terraform está devidamente instalado vá no seu powershell e digite o seguinte comando:</p>
<div class="highlight"><pre><span></span><code>terraform --version 
</code></pre></div>
<p>Com a imagem a seguir:</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/72319195/235461220-2acd6748-ec28-4114-98f1-b0909cc2593d.png" /></p>
<h3 id="configuracao-aws">Configuração AWS<a class="headerlink" href="#configuracao-aws" title="Permanent link">&para;</a></h3>
<h4 id="criacao-de-usuario-e-acesso-as-credenciais">Criação de usuário e acesso as credenciais<a class="headerlink" href="#criacao-de-usuario-e-acesso-as-credenciais" title="Permanent link">&para;</a></h4>
<p>Para criar credenciais na AWS para usar com o Terraform posteriormente, siga as etapas abaixo:</p>
<ul>
<li>
<p>Faça login na AWS Management Console em <a href="https://console.aws.amazon.com/">https://console.aws.amazon.com/</a></p>
</li>
<li>
<p>Navegue até a página de serviços e selecione "IAM" no menu "Security, Identity &amp; Compliance".</p>
</li>
<li>
<p>Na página do IAM, selecione "Usuários" no painel de navegação esquerdo e clique no botão "Adicionar usuário".</p>
</li>
<li>
<p>Na página "Adicionar usuário", digite um nome de usuário e selecione "Acesso programático" como tipo de acesso. Em seguida, clique no botão "Avançar: Permissões".</p>
</li>
<li>
<p>Na página "Adicionar permissões", selecione "Anexar políticas existentes diretamente" e selecione a política "AdministratorAccess" (ou outra política que conceda as permissões necessárias para gerenciar sua infraestrutura da AWS usando o Terraform). Em seguida,clique no botão "Avançar: Tags" (opcional).</p>
</li>
<li>
<p>Na página "Adicionar tags", adicione tags (opcional) e clique no botão "Avançar: Revisar".</p>
</li>
<li>
<p>Na página "Revisar", revise as configurações da conta do usuário e clique no botão "Criar usuário".</p>
</li>
<li>
<p>Na página "Usuários", selecione o usuário recém-criado e clique na guia "Credenciais de segurança".</p>
</li>
<li>
<p>Agora na mesma guia você pode criar as "chaves de acesso":</p>
</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/082308d3-61b3-4b79-9342-21a2ff4f8d6c" /></p>
<ul>
<li>Anote ou baixe as chaves de acesso (Access Key ID e Secret Access Key) para uso posterior com o Terraform.</li>
</ul>
<p>Agora que você criou as credenciais de acesso programático na AWS, você pode usar essas credenciais para autenticar o Terraform e gerenciar sua infraestrutura na AWS. Certifique-se de armazenar as chaves de acesso com segurança e de nunca compartilhar essas informações com outras pessoas.</p>
<h4 id="configuracao-da-sua-conta-aws-no-powershell">Configuração da sua conta AWS no powershell<a class="headerlink" href="#configuracao-da-sua-conta-aws-no-powershell" title="Permanent link">&para;</a></h4>
<h4 id="1-opcao">1 opção<a class="headerlink" href="#1-opcao" title="Permanent link">&para;</a></h4>
<p>Para configurar a AWS pelo AWS CLI (command Line Interface),siga o tutorial abaixo:  <br />
      -  <a href="https://www.youtube.com/watch?v=saSaoZJVQnk&amp;t=34s">https://www.youtube.com/watch?v=saSaoZJVQnk&amp;t=34s</a></p>
<p>Para configurar sua conta no powershell, com o AWS CLI instalado, execute o comando "aws configure" no prompt de comando ou terminal e siga as instruções para inserir suas credenciais de acesso:</p>
<ul>
<li>Execute o comando "aws configure" no prompt de comando ou terminal</li>
<li>Insira suas credenciais de acesso à AWS (chave de acesso e chave secreta) quando solicitado. Você pode obter essas credenciais na seção "Security Credentials" no Console de Gerenciamento da AWS.</li>
</ul>
<p><img alt="image" src="https://user-images.githubusercontent.com/72319195/235463289-3f9182ab-dbf3-4d1a-b279-c584b83e0d6b.png" /></p>
<ul>
<li>Escolha a região padrão para seus recursos da AWS, se solicitado.</li>
</ul>
<p><img alt="image" src="https://user-images.githubusercontent.com/72319195/235463366-3cb7ecbd-5582-44fd-8baa-829e236c5688.png" /></p>
<ul>
<li>Escolha o formato padrão para as saídas do AWS CLI, se solicitado.</li>
</ul>
<p><img alt="image" src="https://user-images.githubusercontent.com/72319195/235463479-1c2aa697-dd60-408c-930d-a0fee9779638.png" /></p>
<p>Certifique-se de que suas credenciais estejam configuradas corretamente e que você tenha as permissões necessárias para acessar os recursos da AWS que está tentando acessar.</p>
<h4 id="2-opcao">2 opção<a class="headerlink" href="#2-opcao" title="Permanent link">&para;</a></h4>
<p>Para configurar a AWS no PowerShell para usar o Terraform, você não precisa necessariamente estar no diretório do seu projeto. No entanto, é importante que você tenha o arquivo de configuração de credenciais da AWS (geralmente localizado em <code>~/.aws/credentials</code> no Linux ou macOS e em <code>C:\Users\USERNAME\.aws\credentials</code> no Windows) configurado corretamente com as credenciais da sua conta da AWS.</p>
<p>Depois de configurar o arquivo de credenciais da AWS, você pode configurar as credenciais da AWS no PowerShell usando as seguintes variáveis de ambiente:</p>
<div class="highlight"><pre><span></span><code>$env:AWS_ACCESS_KEY_ID=&quot;SUA_ACCESS_KEY_ID&quot;
$env:AWS_SECRET_ACCESS_KEY=&quot;SUA_SECRET_ACCESS_KEY&quot;
$env:AWS_DEFAULT_REGION=&quot;REGIÃO_PREFERENCIAL&quot;
</code></pre></div>
<h2 id="utilizacao-terraform">Utilização terraform<a class="headerlink" href="#utilizacao-terraform" title="Permanent link">&para;</a></h2>
<p>Agora já estamos prontos pra utlizar o projeto com as configurações do terraform e da AWS, ou seja, os principais comandos do terraform (vistos ao longo desse tutorial) para a criação da infraestrutura serão vistos na AWS. Por isso, como um fluxo de trabalho interessante é importante fazer o trabalho de forma local e ,posteriormente, conferir todas as atualizações no seu console da AWS.</p>
<p>Para baixar esse projeto vá em algum diretório da sua máquina e digite :
<div class="highlight"><pre><span></span><code>git clone https://github.com/gabri190/AWS-lambda.git
</code></pre></div></p>
<p>Para aqueles que não possuem alguma dependência necessária para esse projeto, foi criado um arquivo requirements.txt e para rodar utilize o seguinte comando abaixo:</p>
<div class="highlight"><pre><span></span><code>pip install -r requirements.txt
</code></pre></div>
<p>Como já instalei, a imagem a seguir mostrará as dependências já instaladas</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/3cb6db53-5319-415d-875a-6a75ff1fc2b6" /></p>
<p>Agora com o projeto já baixado, podemos começar a utilizar os principais comandos do terraform para subir nossa infraestrura.Dessa maneira, vá ao diretório onde seu projeto foi clonado anteriormente e digite o seguinte comando:
<div class="highlight"><pre><span></span><code>terraform init
</code></pre></div></p>
<p>A imagem a seguir mostrará a saida adequada com a infraestrutura sendo inicializada:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/8a3ed6ae-b51b-4914-bc9d-f1e6a69be38e" /></p>
<p>Você pode utilizar o comando validate para validar a sintaxe do arquivo de configuração do Terraform. Ele verifica se o arquivo de configuração está correto em termos de sintaxe e de acordo com a documentação da versão do Terraform que você está usando,como a seguir:</p>
<div class="highlight"><pre><span></span><code>terraform validate
</code></pre></div>
<p>A imagem a seguir mostrará a saida adequada com a infraestrutura validada em sintaxe:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/90602309-8c7e-40a6-9d9c-6e84243ec48d" /></p>
<p>A seguir será utilizado o comando plan. Esse comando é usado para criar um plano de execução que mostra o que o Terraform fará quando você executar o comando apply. O plano mostra quais recursos serão criados, atualizados ou excluídos e quaisquer mudanças no estado que ocorrerão como resultado dessas ações. O plano é uma visualização útil do que o Terraform fará e permite que você verifique se está satisfeito com as mudanças antes de executar o comando apply.
<div class="highlight"><pre><span></span><code>terraform plan
</code></pre></div></p>
<p>A imagem a seguir mostrará a seguida adequada com a infraestrutura sendo planejada:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/bd4538ee-68ba-41b5-95dc-bdb378d04bb7" /></p>
<p>Agora por fim podemos aplicar a infraestrutura e subi-lá na AWS por meio do comando apply, mostrado a seguir (pode demorar uns minutinhos):.
<div class="highlight"><pre><span></span><code>terraform apply -auto-approve
</code></pre></div></p>
<p>A imagem a seguir mostrará a seguida adequada com a infraestrutura sendo aplicada:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/b847cc46-8e0d-44eb-be9d-4afc9799ab5d" /></p>
<h2 id="teste-infraestrutura-aws">Teste Infraestrutura AWS<a class="headerlink" href="#teste-infraestrutura-aws" title="Permanent link">&para;</a></h2>
<h3 id="recursos-criados">Recursos Criados<a class="headerlink" href="#recursos-criados" title="Permanent link">&para;</a></h3>
<p>Primeiramente, é necessário saber se os recursos de fato foram criados na AWS:</p>
<ul>
<li>Acesse o console da AWS com o seu login e senha da AWS:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/9a6e3144-d068-45ff-be7b-4d651bd00086" /></p>
<ul>
<li>Verifique a criação dos serviços procurando nesse campo: </li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/102490b6-a3cf-4f6f-bce9-17095705aaf5" /></p>
<p>Procure em sequência com os nomes "SQS" , "Lambda", "RDS" e DynamoDB"</p>
<h4 id="criacao-sqs">Criação SQS<a class="headerlink" href="#criacao-sqs" title="Permanent link">&para;</a></h4>
<p>Procure por project-terraform-event-notification-queue e clique para ir à pagina a seguir:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/193739f0-05b0-4a17-af95-d2782234fd33" /></p>
<h4 id="criacao-lambda-function">Criação lambda Function<a class="headerlink" href="#criacao-lambda-function" title="Permanent link">&para;</a></h4>
<p>Procure por project-terraform-lambda-function e clique para ir à pagina a seguir:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/9b5d635e-6b91-43d0-bddb-49cf64937a83" /></p>
<h4 id="criacao-rds">Criação RDS<a class="headerlink" href="#criacao-rds" title="Permanent link">&para;</a></h4>
<p>Ao chegar a página após procurar por "RDS" no campo de pesquisa na parte esquerda procure por bancos de dados e clique para ir à pagina, posteriormente você será redirecionado a página dos bancos e clique no único banco e irá para a próxima página:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/53f4f91f-0503-414c-b028-7433b07039e6" /></p>
<h4 id="criacao-dynamodb">Criação DynamoDB<a class="headerlink" href="#criacao-dynamodb" title="Permanent link">&para;</a></h4>
<p>Ao chegar a página após procurar por "DyanamoDB" no campo de pesquisa na parte esquerda procure por tabelas e clique para ir à pagina, posteriormente você será redirecionado a página de tabelas e clique na única tabela e irá para a próxima página:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/3b82029d-2bab-4f3c-b8b5-b26f511db43a" /></p>
<h3 id="teste-dos-recursos">Teste dos Recursos<a class="headerlink" href="#teste-dos-recursos" title="Permanent link">&para;</a></h3>
<p>Agora podemos testar os recursos criados na AWS, como visto anteriormente:</p>
<ul>
<li>Com tudo criado volte para a função lambda criada, e na parte principal vá em testar:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/28506f13-a504-43e8-893a-2473b20af3dc" /></p>
<ul>
<li>Substitua o JSON do evento pelo código a seguir:</li>
</ul>
<p>test.json<br />
 <div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;Records&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="nt">&quot;messageId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;059f36b4-87a3-44ab-83d2-661975830a7d&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;receiptHandle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\n     \&quot;CustID\&quot;: 1021,\n     \&quot;Name\&quot;: \&quot;Martha Rivera\&quot;\n}&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;ApproximateReceiveCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;SentTimestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1545082649183&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;SenderId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AIDAIENQZJOLO23YVJ4VO&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;ApproximateFirstReceiveTimestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1545082649185&quot;</span>
<span class="w">       </span><span class="p">},</span>
<span class="w">       </span><span class="nt">&quot;messageAttributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">       </span><span class="nt">&quot;md5OfBody&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;e4e68fb7bd0e697a0ae8f1bb342846b3&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;eventSource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:sqs&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;eventSourceARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;awsRegion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<ul>
<li>
<p>Salve o evento e volte para o Banco de dados RDS que foi criado!</p>
</li>
<li>
<p>Observe a imagem a seguir:</p>
</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/53f4f91f-0503-414c-b028-7433b07039e6" /></p>
<ul>
<li>
<p>Na imagem anterior você viu a instância de banco de dados que foi criada, com isso, guarde o valor da Endpoint (está em segurança e conexão em Endpoint e Porta) , pois iremos utilizá-la para acessar o banco de dados, lembrando que cada usuário possuirá uma endpoint diferente.</p>
</li>
<li>
<p>Agora volte a função lambda e na parte de código,você verá o código a seguir:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># rds settings</span>
<span class="n">rds_host</span>  <span class="o">=</span> <span class="s2">&quot;My_RDS_Endpoint&quot;</span>
<span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;admin-gabriel&quot;</span>
<span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;database_lambda&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># create the database connection outside of the handler to allow connections to be</span>
<span class="c1"># re-used by subsequent function invocations.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">rds_host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user_name</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db_name</span><span class="p">,</span> <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">MySQLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: Unexpected error: Could not connect to MySQL instance.&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SUCCESS: Connection to RDS MySQL instance succeeded&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates a new RDS database table and writes records to it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">CustID</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;CustID&#39;</span><span class="p">]</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>

    <span class="n">item_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sql_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;insert into Customer (CustID, Name) values(</span><span class="si">{</span><span class="n">CustID</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">Name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>

    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table if not exists Customer ( CustID  int NOT NULL, Name varchar(255) NOT NULL, PRIMARY KEY (CustID))&quot;</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_string</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select * from Customer&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The following items have been added to the database:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
            <span class="n">item_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="s2">&quot;Added </span><span class="si">%d</span><span class="s2"> items to RDS MySQL table&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">item_count</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Nessa parte do código: </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">rds_host</span>  <span class="o">=</span> <span class="s2">&quot;My_RDS_Endpoint&quot;</span>
</code></pre></div>
<p>Substitua o valor de My_RDS_Endpoint pelo valor da endpoint que você guardou anteriormente.</p>
<ul>
<li>Agora sim com JSON de evento salvo e o código substituído, clique em testar e a imagem a seguir deverá aparecer avisando que 1 item foi adicionado ao RDS:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/17ef8b8f-bee4-4e5e-b7d1-732d54e3cc04" /></p>
<ul>
<li>Agora volte ao recurso criado do SQS (queue) ,clique na queue criada e posteriormente, clique em enviar e receber mensagens e já nessa página envie a mensagem a seguir:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/62bd7e54-2eee-4e8a-8ff7-7aaa1de4ace4" /></p>
<ul>
<li>A mensagem correspondente em um json:</li>
</ul>
<p>sqs_test.json
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;CustID&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1054</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Richard Roe&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<ul>
<li>Podemos ver essas criações por meio do cloudwatch, pesquise por cloudwatch e ao chegar à página clique em Grupos de Logs na parte de Logs:</li>
</ul>
<div align="center">

<img src="https://github.com/gabri190/AWS-lambda/assets/72319195/8694085c-df38-4c91-ade2-884ffa260868">

</div>

<ul>
<li>Clique em   <strong>/aws/lambda/project-terraform-lambda-function</strong> :</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/549d9236-4f4d-4ac7-976b-44998c587734" /></p>
<ul>
<li>Clique no último log criado (o primeiro de cima pra baixo):</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/0aa71985-92ce-4c66-a848-5b238d82e182" /></p>
<ul>
<li>Após isso teremos a imagem :  </li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/e576eec3-1d77-404b-a2a5-54a1ee3fdec4" /></p>
<ul>
<li>Na imagem anterior percebemos, entre todas as mensagens, a criação de 2 items de maneira que um deles foi criado no JSON de evento simulado e outro por meio do envio da mensagem da SQS para a função lambda:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/a0e2976a-4611-46fd-89b1-bb838a313978" /></p>
<ul>
<li>Agora modifique o código python na seção de códigos da função lambda para o último teste agora em relação ao DynamoDB!  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Incoming event: &#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Incoming state: &#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>

<span class="c1">#Check if this is the end of the window to either aggregate or process.</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isFinalInvokeForWindow&#39;</span><span class="p">]:</span>
        <span class="c1"># logic to handle final state of the window</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Destination invoke&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Aggregate invoke&#39;</span><span class="p">)</span>

<span class="c1">#Check for early terminations</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;isWindowTerminatedEarly&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Window terminated early&#39;</span><span class="p">)</span>

    <span class="c1">#Aggregation logic</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">]:</span>
        <span class="n">state</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">][</span><span class="s1">&#39;Keys&#39;</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">][</span><span class="s1">&#39;Keys&#39;</span><span class="p">][</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Returning state: &#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">}</span>
</code></pre></div>
<ul>
<li>Modifique também o JSON de evento:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Records&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;eventID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventSource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:dynamodb&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;awsRegion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;dynamodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;NewImage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New item!&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;SequenceNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;111&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;SizeBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;StreamViewType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NEW_AND_OLD_IMAGES&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;eventSourceARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stream-ARN&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;eventID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MODIFY&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventSource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:dynamodb&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;awsRegion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;dynamodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;NewImage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This item has changed&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;OldImage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;New item!&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;SequenceNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;222&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;SizeBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">59</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;StreamViewType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NEW_AND_OLD_IMAGES&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;eventSourceARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stream-ARN&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;eventID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;REMOVE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eventSource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:dynamodb&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;awsRegion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;dynamodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;OldImage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This item has changed&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;SequenceNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;333&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;SizeBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">38</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;StreamViewType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NEW_AND_OLD_IMAGES&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;eventSourceARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stream-ARN&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;window&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2020-07-30T17:00:00Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;end&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2020-07-30T17:05:00Z&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;state1&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;shardId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shard123456789&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;eventSourceARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stream-ARN&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isFinalInvokeForWindow&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;isWindowTerminatedEarly&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ul>
<li>Você verá a seguinte saída:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/2a0a7d7c-6a9e-4f92-80ab-288bf20dc67e" /></p>
<ul>
<li>Pelo cloudwatch podemos ver nos streams de log (clique sempre no último de cima pra baixo) o item criado:</li>
</ul>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/c888ead8-8075-4fcd-a44d-8e4ab48eda29" /></p>
<h2 id="termino-e-destruicao-da-infraestrutura">Término e destruição da Infraestrutura<a class="headerlink" href="#termino-e-destruicao-da-infraestrutura" title="Permanent link">&para;</a></h2>
<p>Ao realizar todos os testes na AWS e conferir todos os recursos precisamos destruir a infraestutura e a seguir alguns motivos pelos quais precisamos realizar essa última ação:</p>
<ul>
<li>
<p>Evitar custos desnecessários: Quando não precisamos mais da infraestrutura que criamos, devemos destruí-la para evitar custos desnecessários de infraestrutura em execução na nuvem.</p>
</li>
<li>
<p>Manter o ambiente limpo: Destruir a infraestrutura garante que o ambiente de nuvem seja mantido limpo e organizado, facilitando a manutenção e a atualização futura do ambiente.</p>
</li>
<li>
<p>Identificar problemas de configuração: Destruir a infraestrutura é uma boa maneira de testar se as configurações do Terraform estão funcionando corretamente. Se a infraestrutura for criada e destruída com sucesso, isso significa que as configurações do Terraform foram escritas corretamente.</p>
</li>
<li>
<p>Flexibilidade: A destruição da infraestrutura com o terraform destroy dá a flexibilidade de recriar a infraestrutura facilmente, se necessário, com as mesmas configurações.</p>
</li>
</ul>
<p>Dito isso, o último comando será aplicado para destruir a infraestrutura.Nesse contexto, no seu terminal destrua a aplicação com o comando a seguir:</p>
<div class="highlight"><pre><span></span><code>terraform destroy
</code></pre></div>
<p>Após destruir a infraestrutura, você verá a saída a seguir:</p>
<p><img alt="image" src="https://github.com/gabri190/AWS-lambda/assets/72319195/b3b2c3e9-dbd6-4eda-8b14-5d6ec5857156" />   </p>
<p>Observações Finais :</p>
<ul>
<li>Os comandos terraform apply e terraform destroy podem demorar mais do que o normal pelos serviços que estão subindo na AWS, por isso, principalmente, no destroy pode ser necessário rodar o comando mais de uma vez!</li>
</ul>
<h2 id="conclusao">Conclusão<a class="headerlink" href="#conclusao" title="Permanent link">&para;</a></h2>
<p>Assim, finalizamos nosso projeto que tinha como intuito o cadastro de usuários em bancos de dados (amazon RDS) e tabelas (DynamoDb), no entanto, note que o ponto central desse projeto diz respeito a função lambda que faz toda a integração entre o sistema de filas (SQS) que realiza o envio da mensagem e os sistemas de armazenamento de dados (RDS e DynamoDB). Por isso, apesar de ser apenas um projeto menor, vê-se a importância da lambda function e de todas as integrações feitas para o sistema de armazenamento de valores (dados de usuários) que pode , por exemplo, servir de backend para um site ou outros usos a depender da iteração para a melhora do projeto. </p>
<h2 id="referencias">Referências<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<p><a href="https://www.youtube.com/watch?v=3E1IcVIaI0A&amp;t=756s">https://www.youtube.com/watch?v=3E1IcVIaI0A&amp;t=756s</a></p>
<p><a href="https://www.youtube.com/watch?v=etru_8t7Dyk&amp;t=2226s">https://www.youtube.com/watch?v=etru_8t7Dyk&amp;t=2226s</a></p>
<p><a href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/services-rds-tutorial.html">https://docs.aws.amazon.com/pt_br/lambda/latest/dg/services-rds-tutorial.html</a></p>
<p><a href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/with-ddb.html">https://docs.aws.amazon.com/pt_br/lambda/latest/dg/with-ddb.html</a>  </p>
<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs">https://registry.terraform.io/providers/hashicorp/aws/latest/docs</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 / Gabriel Araújo / gabrielaa3@al.insper.edu.br
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["instant", "navigation.expand", {"tabs": true}], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>